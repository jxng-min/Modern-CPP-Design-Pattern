## 퍼사드 패턴

</br>

퍼사드는 프랑스어로 출입구가 있는 건물의 앞부분을 의미한다.

</br>
</br>

### 10.1 시나리오

</br>

좋은 금융 거래 프로그램이라면 필요한 정보들을 거래자에게 빠르게 제공할 수 있어야 한다.

금융 상품들의 가격 변화가 일체의 지연 없이 즉시 화면에 업데이트되어야 한다.

</br>

대부분의 금융 데이터는 평범한 문자로 렌더링된다. 예를 들어 검은 배경에 흰 글씨로 나타난다.

OS에서 제공하는 터미널/콘솔의 커맨드 라인 인터페이스와 비슷하지만 미묘한 차이가 있다.

</br>
</br>

### 10.2 터미널의 동작 과정

</br>

터미널 윈도우의 구성 요소는 다음과 같다.

1. 버퍼
2. 뷰포트
3. 콘솔

버퍼에는 렌더링할 문자들이 저장된다.

버퍼는 메모리의 사각형 공간으로 보통 char/wchar_t 타입의 1차원 배열로 만들어진다.

버퍼는 과거의 출력 히스토리를 저장하고 있어 이전 화면으로 스크롤하여 내용을 확인할 수 있다.

</br>

버퍼는 보통 현재의 입력 라인을 가리키는 어떤 표시를 가진다.

그 푯디를 이용해 버퍼가 가득 찼을 때, 항상 새로운 새로운 라인을 할당하는 것이 아니라 오래된 라인부터 덮어쓰며 데이터를 받는다.

</br>

뷰포트는 버퍼의 특정 영역을 화면에 렌더링한다. 버퍼는 보통 매우 커서 뷰포트는 버퍼의 작은 사각형 영역만 취하여 렌더링한다.

뷰포트는 당연하게도 버퍼의 크기보다 작거나 같다.

</br>

콘솔은 뷰포트를 화면에 보여주고 사용자로부터 입력을 받는다. 콘솔은 퍼사드의 역할이다.

뒤에서 일어나는 복잡한 작업들을 단순화하여 표현한다.

</br>
</br>

### 10.3 고급 터미널

</br>

OS에서 제공하는 전형적인 터미널의 문제는 대량 데이터를 파이핑하여 출력할 때 느리다는 점이다.

빠르게 동작해야 하는 금융 거래 환경에서는 하드웨어의 도움을 받아 렌더링을 한다.

문자들은 사전에 렌더링된 텍스처로 표현되어 OpenGL과 같은 그래픽 API를 이용해 화면에 출력된다.

</br>

거래 터미널은 여러 개의 버퍼와 뷰포트로 구성된다.

전형적인 경우 여러 가지 거래, 교환 데이터들이 동시에 서로 다른 버퍼에서 업데이트된다.

이 모든 정보가 하나의 화면에 표현되어야 한다.

</br>

버퍼는 단순히 1차원 선형 저장소를 넘어서서 다른 고급 기능들도 제공한다.

예를 들어 아래의 TableBuffer는 표 형태로 정리하여 출력하는 버퍼다.

</br>

```C++
struct TableBuffer : IBuffer
{
public:
    TableBuffer(std::vector<TableColumnSpec> spec, int totla_height)
    {
        ...
    }

    struct TableColumnSpec
    {
        string header;
        int width;

        enum class TableColumnAlignment
        {
            Left, Center, Right
        } alignment;
    }
};
```
</br>

위의 코드는 어떤 주어진 명세에 따라 데이터를 표로 정리하여 화면에 보여준다.

뷰포트는 버퍼로부터 데이터를 가져오는 역할을 한다. 다음은 뷰포트가 가지는 속성 중 일부다.

* 보여줄 버퍼로의 참조

* 크기

* 뷰포트의 버퍼 범위 지정

* 전체 콘솔 윈도우에서의 뷰포트 위치

* 커서의 위치

</br>
</br>

### 10.4 퍼사드는 어디에?

</br>

현재 예로 들고 있는 금융 거래 시스템에서는 콘솔 자체가 퍼사드다.

콘솔 내부에서 많은 수의 서로 다른 객체들이 동작한다.

</br>

```C++
struct Console
{
    std::vector<Viewport*> viewports;
    Size char_size;
    Size grid_size;
}
```
</br>

콘솔의 초기화 작업은 일반적으로 대단히 복잡하고 손이 많이 간다.

그럼에도 불구하고 콘솔은 퍼사드기 때문에 최대한 편리한 API를 제공하기 위해 노력해야 한다.

이를 위해 콘솔 내부의 모든 구성 요소를 초기화하는데 필요한 파라미터들을 직관적으로 이해하기 쉽게 정의한다.
